<?php if(!defined('BCGT')) exit; ?>

<?= (!empty($MSGS['errors'])) ? gt_error_alert_box($MSGS['errors']) : '' ?>
<?= (!empty($MSGS['success'])) ? gt_success_alert_box($MSGS['success']) : '' ?>

<form action="" method="post">
    
    <table id='gt_log_search' class='gt_config'>
        
        <tr><th><?= $string['action'] ?></th><th colspan='2'><?= $string['date'] ?></th><th><?= $string['username'] ?></th><th><?= $string['attributes'] ?></th><th><?= $string['limit'] ?></th></tr>
        
        <tr>
            <td>
                <select name='action'>
                    <option value=''><?= $string['all'] ?></option>
                    <option value='<?= \GT\Log::GT_LOG_DETAILS_UPDATED_USER_CRIT ?>'><?= \GT\Log::GT_LOG_DETAILS_UPDATED_USER_CRIT ?></option>
                    <option value='<?= \GT\Log::GT_LOG_DETAILS_UPDATED_USER_UNIT ?>'><?= \GT\Log::GT_LOG_DETAILS_UPDATED_USER_UNIT ?></option>
                    <option value='<?= \GT\Log::GT_LOG_DETAILS_UPDATED_USER_ASS ?>'><?= \GT\Log::GT_LOG_DETAILS_UPDATED_USER_ASS ?></option>
                    <option value='<?= \GT\Log::GT_LOG_DETAILS_UPDATED_USER_ATT ?>'><?= \GT\Log::GT_LOG_DETAILS_UPDATED_USER_ATT ?></option>
                    <option value='<?= \GT\Log::GT_LOG_DETAILS_UPDATED_USER_RANGE ?>'><?= \GT\Log::GT_LOG_DETAILS_UPDATED_USER_RANGE ?></option>
                    <option value='<?= \GT\Log::GT_LOG_DETAILS_UPDATED_USER_GRADE ?>'><?= \GT\Log::GT_LOG_DETAILS_UPDATED_USER_GRADE ?></option>
                    <option value='<?= \GT\Log::GT_LOG_DETAILS_IMPORTED_GRID ?>'><?= \GT\Log::GT_LOG_DETAILS_IMPORTED_GRID ?></option>
                </select>
            </td>
            
            <td>
                <select name='timing'>
                    <option value='e'><?= $string['exact'] ?></option>
                    <option value='b'><?= $string['before'] ?></option>
                    <option value='a'><?= $string['after'] ?></option>
                </select>
            </td>
            
            <td>
                <input type='text' name='date' class='gt_date gt_datepicker' />
            </td>
            
            <td>
                <input type='text' name='user' />
            </td>
            
            <td style='text-align:left;'>
                
                <span><?= $string['qualification'] ?>: 
                    <select id='gt_log_search_qual' name='atts[qual]'>
                        <option value=''></option>
                        <?php if ($allQuals): ?>
                            <?php foreach($allQuals as $qual): ?>
                                <option value='<?= $qual->getID() ?>'>[<?= $qual->getID() ?>] <?= $qual->getDisplayName() ?></option>
                            <?php endforeach; ?>
                        <?php endif; ?>
                    </select>
                    <br>
                </span>
                
                <span><?= $string['unit'] ?>: 
                    <select id='gt_log_search_unit' name='atts[unit]'></select> <img src='<?= $CFG->wwwroot ?>/blocks/gradetracker/pix/ajax-loader.gif' style='display:none;' id='gt_log_search_load' />
                    <br>
                </span>
                
                <span><?= $string['student'] ?>: 
                    <input type='text' name='atts[stud]' value='' />
                    <br>
                </span>
                
            </td>
            
            <td>
                <select name='atts[limit]'>
                    <option value=''><?= $string['all'] ?></option>
                    <option value='10'>10</option>
                    <option value='25'>25</option>
                    <option value='50'>50</option>
                    <option value='100'>100</option>
                    <option value='250'>250</option>
                    <option value='500'>500</option>
                </select>
            </td>
                        
        </tr>
        
    </table>
    
    <br>
    <p class='gt_centre'><input type='submit' name='search' class='gt_btn' value='<?= $string['search'] ?>' /></p>
    
</form>

<br><br>

<div>
    <div class='gt_form_panel_heading'><?= $string['results'] ?>&nbsp;&nbsp;&nbsp;&nbsp;[ <a href='#' onclick="$('.gt_recent_activity_content').show();return false;">+</a> / <a href='#' onclick="$('.gt_recent_activity_content').hide();return false;">-</a> ]</div>
    <div class="gt_form_panel_body">
    <ul class='gt_recent_activity'>
        <?php if (isset($results) && $results): ?>
            <?php foreach($results as $log): ?>
                <li>
                    <div><?= $log->user->getPicture(null, 50) ?></div>
                    <div>
                        <span>
                            <a href='<?= $CFG->wwwroot ?>/user/profile.php?id=<?= $log->user->id ?>'><?= $log->user->getDisplayName() ?></a> <?= $log->details ?>
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <a href='#' onclick='$("#gt_recent_activity_content_<?= $log->id ?>").toggle();return false;'>[<?= $string['showhide'] ?>]</a>
                        </span><br>
                        <div id='gt_recent_activity_content_<?= $log->id ?>' class='gt_recent_activity_content' style='display:none;'><?= $log->getDescription() ?></div>
                        <small><i class="icon-time"></i> <?= \gt_time_ago($log->timestamp) ?></small>
                    </div>
                </li>
            <?php endforeach; ?>
        <?php endif; ?>
    </ul>
    </div>
</div>
